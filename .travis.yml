dist: bionic

language: generic

cache:
  pip: false
  directories:
  - "$HOME/db/"

env:
  global:
  - GIT_NAME: Spirillen
  - GIT_EMAIL: 44526987+spirillen@users.noreply.github.com
  - TRAVIS_REPO_SLUG: "${TRAVIS_REPO_SLUG}"
  - GIT_BRANCH: "${TRAVIS_BRANCH}"
  - TZ: UTC
  - PYTHON_VERSION: 3.8.5
  - SCRIPT_SOURCE_URI: 'https://raw.githubusercontent.com/dns-test/script-hub/master/'
  - PYFUNCEBLE_CONFIG_DIR: "${TRAVIS_BUILD_DIR}/.pyfunceble/"
  - PYFUNCEBLE_OUTPUT_LOCATION: "${TRAVIS_BUILD_DIR}/.pyfunceble/"
  - PYFUNCEBLE_AUTO_CONFIGURATION: yes
  - PYFUNCEBLE_DB_CHARSET="${DB_CHARSET}"
  - PYFUNCEBLE_DB_HOST="${DB_HOST}"
  - PYFUNCEBLE_DB_NAME="${DB_NAME}"
  - PYFUNCEBLE_DB_USERNAME="${DB_USERNAME}"
  - PYFUNCEBLE_DB_PASSWORD="${DB_PASSWORD}"
  - PYFUNCEBLE_DB_PORT="${DB_PORT}"

install:
  # https://www.mypdns.org/source/sh/repository/master/
  - wget -qLO "${TRAVIS_BUILD_DIR}/setup_travis.sh"
    "${SCRIPT_SOURCE_URI}/travis/setup_travis.sh" &&
    sudo chmod +x "${TRAVIS_BUILD_DIR}/setup_travis.sh"
  - sudo bash "${TRAVIS_BUILD_DIR}/setup_travis.sh"

git:
  depth: 2

script:
  - bash "${TRAVIS_BUILD_DIR}/dns-test.sh"
  - truncate -s 0 "${TRAVIS_BUILD_DIR}/run_id"
  - echo "${TRAVIS_JOB_ID}" > "${TRAVIS_BUILD_DIR}/run_id"
